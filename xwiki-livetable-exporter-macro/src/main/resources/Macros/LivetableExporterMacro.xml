<?xml version="1.0" encoding="UTF-8"?>

<!--
 * See the NOTICE file distributed with this work for additional
 * information regarding copyright ownership.
 *
 * This is free software; you can redistribute it and/or modify it
 * under the terms of the GNU Lesser General Public License as
 * published by the Free Software Foundation; either version 2.1 of
 * the License, or (at your option) any later version.
 *
 * This software is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this software; if not, write to the Free
 * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
 * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
-->

<xwikidoc version="1.3" reference="Macros.LivetableExporterMacro" locale="">
  <web>Macros</web>
  <name>LivetableExporterMacro</name>
  <language/>
  <defaultLanguage/>
  <translation>0</translation>
  <creator>xwiki:XWiki.Admin</creator>
  <creationDate>1577833200000</creationDate>
  <parent>Macros.WebHome</parent>
  <author>xwiki:XWiki.Admin</author>
  <contentAuthor>xwiki:XWiki.Admin</contentAuthor>
  <date>1577833200000</date>
  <contentUpdateDate>1577833200000</contentUpdateDate>
  <version>1.1</version>
  <title>Livetable Exporter Macro</title>
  <comment/>
  <minorEdit>false</minorEdit>
  <syntaxId>xwiki/2.0</syntaxId>
  <hidden>true</hidden>
  <content>== Usage ==

{{code}}
{{livetableExporter livetable="my-livetable" /}}
{{/code}}

Where "{{code}}my-livetable{{/code}}" is your livetable's name.

== Parameters ==

{{velocity}}
#set ($parameters = $doc.getObjects('XWiki.WikiMacroParameterClass'))
#set ($tableHeaders = '|=Name|=Description|=Mandatory|=Default')
#set ($tableBody = '')
#foreach ($parameter in $parameters)
#set ($isMandatory = ${parameter.getProperty('mandatory').value})
#if ($isMandatory == 1) #set ($isMandatory = "Yes") #else #set ($isMandatory = "No") #end
#set ($tableBody = "$tableBody|${parameter.getProperty('name').value}|(((${parameter.getProperty('description').value})))|$isMandatory|$parameter.getProperty('defaultValue').value
")
#end
## This option is handy for generating the code to be pasted to the online extension.xwiki.org page for documenting the parameters statically.
#if ($request.debug)
{{code}}
$tableHeaders
$tableBody
{{/code}}
#end

$tableHeaders
$tableBody
{{/velocity}}


== Credits ==

* For this macro, see [[the page on XWiki Extensions site&gt;&gt;http://extensions.xwiki.org/xwiki/bin/view/Extension/LivetableExporter Macro]].
* This macro is based on [[a patch by Ludovic Dubost&gt;&gt;http://jira.xwiki.org/browse/XWIKI-5458]].
</content>
  <object>
    <name>Macros.LivetableExporterMacro</name>
    <number>0</number>
    <className>XWiki.JavaScriptExtension</className>
    <guid>1535c9ad-3989-48f2-9324-aa47cf614485</guid>
    <class>
      <name>XWiki.JavaScriptExtension</name>
      <customClass/>
      <customMapping/>
      <defaultViewSheet/>
      <defaultEditSheet/>
      <defaultWeb/>
      <nameField/>
      <validationScript/>
      <cache>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>select</displayType>
        <multiSelect>0</multiSelect>
        <name>cache</name>
        <number>5</number>
        <prettyName>Caching policy</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator> </separator>
        <separators>|, </separators>
        <size>1</size>
        <unmodifiable>0</unmodifiable>
        <values>long|short|default|forbid</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </cache>
      <code>
        <contenttype>PureText</contenttype>
        <disabled>0</disabled>
        <editor>PureText</editor>
        <name>code</name>
        <number>2</number>
        <prettyName>Code</prettyName>
        <rows>20</rows>
        <size>50</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
      </code>
      <name>
        <disabled>0</disabled>
        <name>name</name>
        <number>1</number>
        <prettyName>Name</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </name>
      <parse>
        <disabled>0</disabled>
        <displayFormType>select</displayFormType>
        <displayType>yesno</displayType>
        <name>parse</name>
        <number>4</number>
        <prettyName>Parse content</prettyName>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
      </parse>
      <use>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>select</displayType>
        <multiSelect>0</multiSelect>
        <name>use</name>
        <number>3</number>
        <prettyName>Use this extension</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator> </separator>
        <separators>|, </separators>
        <size>1</size>
        <unmodifiable>0</unmodifiable>
        <values>currentPage|onDemand|always</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </use>
    </class>
    <property>
      <cache>long</cache>
    </property>
    <property>
      <code>#set($discard = $services.localization.use('document', 'Macros.LivetableExporterMacroLabels'))

require(['jquery'], function(jQuery) {
 var formatText = {}
 formatText.excel = "$services.localization.render('xwiki.macro.livetableExporter.format.excel')";
 formatText.csv = "$services.localization.render('xwiki.macro.livetableExporter.format.csv')";
 formatText.json = "$services.localization.render('xwiki.macro.livetableExporter.format.json')";

 /**
 * Function adding export to file function to the livetable
 */
  XWiki.widgets.LiveTable.exportToFile = function (withPageName, withPageURL, withAllFields, filename, format, resultsPage, limit, async, downloadPage) {
    console.log("in export");
    // Get the final part of the data sources URL, after the ?
    var urlParameters = this.getUrl.substr(this.getUrl.indexOf('?'));
    if ((async=="true") &amp;&amp; (resultsPage=='Macros.LivetableExporterResults'))
      resultsPage += "Async";
    var resultsPageReference = XWiki.Model.resolve(resultsPage, XWiki.EntityType.DOCUMENT);
    var macroDataSourcesDocument = new XWiki.Document(resultsPageReference);
    // Compute the URL for the file export action
    if (isNaN(limit)) {
      limit = 0;
    }
    var urlParams = urlParameters + '&amp;limit=' + limit + '&amp;reqNo=' + (++this.sendReqNo);
    if(withPageName) {
      urlParams += '&amp;withPageName=true';
    }
    if(withPageURL) {
      urlParams += '&amp;withPageURL=true';
    }
    if(withAllFields) {
      urlParams += '&amp;withAllFields=true';
    }
    if (filename != '') {
      urlParams += '&amp;filename=' + encodeURIComponent(filename);
    }
    if (format != '') {
      urlParams += '&amp;outputSyntaxType=' + encodeURIComponent(format);
    }
    if (this.filter) {
         this.filters = this.filter.serializeFilters();
        if (this.filters != undefined &amp;&amp; this.filters != "") {
            urlParams += this.filters;
        }
    }
    if (typeof this.tags != "undefined" &amp;&amp; this.tags.length &gt; 0) {
       this.tags.each(function (tag) {
            urlParams += ("&amp;tag=" + encodeURIComponent(tag.unescapeHTML()));
        });
    }
    urlParams += this.getSortURLFragment();

    if (async=="true") {
      console.log("in async");
      urlParams = urlParams.replace('outputSyntax=plain&amp;', '')
      urlParams += '&amp;async=true';

      var url = macroDataSourcesDocument.getURL('get') + urlParams;
  
      // Compute the URL for the final download
      // this will be read by the job done callback
      var downloadPageReference = XWiki.Model.resolve(downloadPage, XWiki.EntityType.DOCUMENT);
      var downloadDocument = new XWiki.Document(downloadPageReference);
      window.downloadUrl = downloadDocument.getURL('get') + urlParams;
      
      var confirmationText = "$services.localization.render('xwiki.macro.livetableExporter.async.confirm')"

      new XWiki.widgets.ConfirmationBox({
        onYes: function() {
          jQuery('#xwiki-livetable-tools-exporter-status').load(url, function() {
            // Once result is loaded, we should activate the Job Macro JS code
            XWiki.widgets.LiveTable.updateJobUI();
          });
      },
       onNo: function() {
          // nothing to do
       }
      }, {
        confirmationText: confirmationText.replace("{0}", this.totalRows).replace("{1}", formatText[format]),
        yesButtonText: "$services.localization.render('core.widgets.confirmationBox.button.yes')",
        noButtonText: "$services.localization.render('core.widgets.confirmationBox.button.no')"
      });
    } else {
      // Launch the export
      location = macroDataSourcesDocument.getURL('get') + urlParams;
    }
  };

});
</code>
    </property>
    <property>
      <name>JSX</name>
    </property>
    <property>
      <parse>1</parse>
    </property>
    <property>
      <use>onDemand</use>
    </property>
  </object>
  <object>
    <name>Macros.LivetableExporterMacro</name>
    <number>1</number>
    <className>XWiki.JavaScriptExtension</className>
    <guid>684d0a04-e8f9-4bbc-bcb6-af7c901f9dd2</guid>
    <class>
      <name>XWiki.JavaScriptExtension</name>
      <customClass/>
      <customMapping/>
      <defaultViewSheet/>
      <defaultEditSheet/>
      <defaultWeb/>
      <nameField/>
      <validationScript/>
      <cache>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>select</displayType>
        <multiSelect>0</multiSelect>
        <name>cache</name>
        <number>5</number>
        <prettyName>Caching policy</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator> </separator>
        <separators>|, </separators>
        <size>1</size>
        <unmodifiable>0</unmodifiable>
        <values>long|short|default|forbid</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </cache>
      <code>
        <contenttype>PureText</contenttype>
        <disabled>0</disabled>
        <editor>PureText</editor>
        <name>code</name>
        <number>2</number>
        <prettyName>Code</prettyName>
        <rows>20</rows>
        <size>50</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
      </code>
      <name>
        <disabled>0</disabled>
        <name>name</name>
        <number>1</number>
        <prettyName>Name</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </name>
      <parse>
        <disabled>0</disabled>
        <displayFormType>select</displayFormType>
        <displayType>yesno</displayType>
        <name>parse</name>
        <number>4</number>
        <prettyName>Parse content</prettyName>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
      </parse>
      <use>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>select</displayType>
        <multiSelect>0</multiSelect>
        <name>use</name>
        <number>3</number>
        <prettyName>Use this extension</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator> </separator>
        <separators>|, </separators>
        <size>1</size>
        <unmodifiable>0</unmodifiable>
        <values>currentPage|onDemand|always</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </use>
    </class>
    <property>
      <cache>long</cache>
    </property>
    <property>
      <code>require.config({
  paths: {
    JobRunner: "$!services.webjars.url('org.xwiki.platform:xwiki-platform-job-webjar', 'jobRunner.min')"
  }
});

console.log("before job jsx");
require(['jquery', 'JobRunner', 'xwiki-events-bridge'], function($, JobRunner) {
  console.log("in job jsx");
  'use strict';
  var updateProgress = function(jobUI, job) {
    var percent = Math.floor((job.progress.offset || 0) * 100);
    jobUI.find('.ui-progress-bar').css('width', percent + '%');
    var jobLog = job.log.items || [];
    if (jobLog.size() &gt; 0) {
      jobUI.find('.ui-progress-message').html(jobLog[jobLog.size() - 1].renderedMessage);
    }
  };

  var updateLog = function(jobUI, job) {
    var jobLog = job.log.items || [];
    var jobLogUI = jobUI.find('.log');
    if (job.log.offset === 0) {
      jobLogUI.html('');
    }
    jobLogUI.find('.log-item-loading').removeClass('log-item-loading');
    $.each(jobLog, function(index, item) {
      var classNames = ['log-item', 'log-item-' + item.level];
      if (job.state !== 'FINISHED' &amp;&amp; index === jobLog.size() - 1) {
        classNames.push('log-item-loading');
      }
      $(document.createElement('li')).addClass(classNames.join(' ')).html(item.renderedMessage).appendTo(jobLogUI);
    })
  };

  var updateStatus = function(job) {
    var jobUI = $(this);
    updateProgress(jobUI, job);
    updateLog(jobUI, job);
  };

  var notifyJobDone = function(job) {
    var jobUI = $(this);
    jobUI.find('.ui-progress').replaceWith(job.message);
    jobUI.trigger('job:done', job);
  };

  var notifyConnectionFailure = function() {
  };

  var enhanceStackTrace = function(container) {
    container.find('.log-item').each(function() {
      var stacktrace = $(this).find('.stacktrace');
      if (stacktrace) {
        // Hide the stacktrace by default.
        stacktrace.toggle();
        // Show the stacktrace when the log message is clicked.
        var logMessage = $(this).find('div');
        logMessage.css({
          "cursor" : "pointer"
        });
        logMessage.click(function() {
          stacktrace.toggle();
        });
      }
    });
  };

  var autoScrollLog = function(container) {
    // Scroll the log to the end if it has a loading item.
    // TODO: Preserve the scroll position if the user scrolls through the log.
    container.find('.log').has('.log-item-loading').each(function() {
      this.scrollTop = this.scrollHeight;
    });
  };

  var getTarget = function(trigger) {
    try {
      return document.evaluate(trigger.getAttribute('data-target-xpath'), trigger, null,
        XPathResult.FIRST_ORDERED_NODE_TYPE, null).singleNodeValue;
    } catch (e) {
      console &amp;&amp; console.log(e);
      return null;
    }
  };

  var collapsibleLog = function(container) {
    // Initial state.
    container.find('.collapse-toggle.collapsed').each(function() {
      $(getTarget(this)).addClass('hidden');
    });
    // Expand/Collapse on click.
    container.find('.collapse-toggle').click(function () {
      $(this).toggleClass('collapsed');
      $(getTarget(this)).toggleClass('hidden');
    });
  };

  var enhanceLog = function(container) {
    enhanceStackTrace(container);
    autoScrollLog(container);
    collapsibleLog(container);
  }

  console.log("In job macro jsx");
  XWiki.widgets.LiveTable.updateJobUI = function () {
   console.log("In job macro updateJobUI");
   enhanceLog($('body'));

   $('.job-status').has('.ui-progress').each(function() {
    var jobStatus = $(this);
    var url = jobStatus.attr('data-url');
    if (url !== '') {
      var jobLog = jobStatus.find('.log');
      JobRunner({
        createStatusRequest: function() {
          return {
            url: url,
            data: {
              'logOffset': jobLog.find('.log-item').size()
            }
          };
        }
      }).resume()
        .progress($.proxy(updateStatus, this))
        .done($.proxy(notifyJobDone, this))
        .fail($.proxy(notifyConnectionFailure, this));
    }
   });

   $('.job-status').has('.ui-progress').on('job:done', function() {
     $('#xwiki-livetable-tools-exporter-status').find(".box").append("&lt;a href='" + window.downloadUrl 
       + "'&gt;$services.localization.render('xwiki.macro.livetableExporter.async.download')&lt;/a&gt;");
   });
  };
});</code>
    </property>
    <property>
      <name>job</name>
    </property>
    <property>
      <parse>1</parse>
    </property>
    <property>
      <use>currentPage</use>
    </property>
  </object>
  <object>
    <name>Macros.LivetableExporterMacro</name>
    <number>0</number>
    <className>XWiki.RequiredRightClass</className>
    <guid>c0400289-10c9-4fdc-b5a8-5af70b452b88</guid>
    <class>
      <name>XWiki.RequiredRightClass</name>
      <customClass/>
      <customMapping/>
      <defaultViewSheet/>
      <defaultEditSheet/>
      <defaultWeb/>
      <nameField/>
      <validationScript/>
      <level>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>select</displayType>
        <multiSelect>0</multiSelect>
        <name>level</name>
        <number>1</number>
        <picker>0</picker>
        <prettyName>level</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator> </separator>
        <separators> ,|</separators>
        <size>1</size>
        <sort>none</sort>
        <unmodifiable>0</unmodifiable>
        <validationMessage/>
        <validationRegExp/>
        <values>edit|programming</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </level>
    </class>
    <property>
      <level>programming</level>
    </property>
  </object>
  <object>
    <name>Macros.LivetableExporterMacro</name>
    <number>0</number>
    <className>XWiki.StyleSheetExtension</className>
    <guid>9c71a455-1104-4f1d-8e00-417246ca43a4</guid>
    <class>
      <name>XWiki.StyleSheetExtension</name>
      <customClass/>
      <customMapping/>
      <defaultViewSheet/>
      <defaultEditSheet/>
      <defaultWeb/>
      <nameField/>
      <validationScript/>
      <cache>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>select</displayType>
        <multiSelect>0</multiSelect>
        <name>cache</name>
        <number>5</number>
        <prettyName>Caching policy</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator> </separator>
        <separators>|, </separators>
        <size>1</size>
        <unmodifiable>0</unmodifiable>
        <values>long|short|default|forbid</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </cache>
      <code>
        <contenttype>PureText</contenttype>
        <disabled>0</disabled>
        <editor>PureText</editor>
        <name>code</name>
        <number>2</number>
        <prettyName>Code</prettyName>
        <rows>20</rows>
        <size>50</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
      </code>
      <contentType>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>select</displayType>
        <multiSelect>0</multiSelect>
        <name>contentType</name>
        <number>6</number>
        <prettyName>Content Type</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator> </separator>
        <separators>|, </separators>
        <size>1</size>
        <unmodifiable>0</unmodifiable>
        <values>CSS|LESS</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </contentType>
      <name>
        <disabled>0</disabled>
        <name>name</name>
        <number>1</number>
        <prettyName>Name</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </name>
      <parse>
        <disabled>0</disabled>
        <displayFormType>select</displayFormType>
        <displayType>yesno</displayType>
        <name>parse</name>
        <number>4</number>
        <prettyName>Parse content</prettyName>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
      </parse>
      <use>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>select</displayType>
        <multiSelect>0</multiSelect>
        <name>use</name>
        <number>3</number>
        <prettyName>Use this extension</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator> </separator>
        <separators>|, </separators>
        <size>1</size>
        <unmodifiable>0</unmodifiable>
        <values>currentPage|onDemand|always</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </use>
    </class>
    <property>
      <cache>long</cache>
    </property>
    <property>
      <code>.xwiki-livetable-tools-exporter-excel {
  background-image: url($xwiki.getSkinFile('icons/silk/page_white_excel.png'));
  width: 16px;
  height: 16px;
  display: inline-block;
  vertical-align: text-bottom;
  margin-left: 0.3em;
}

.xwiki-livetable-tools-exporter:hover {
  cursor: pointer;
  cursor:hand;
}</code>
    </property>
    <property>
      <contentType>CSS</contentType>
    </property>
    <property>
      <name>SSX</name>
    </property>
    <property>
      <parse>1</parse>
    </property>
    <property>
      <use>onDemand</use>
    </property>
  </object>
  <object>
    <name>Macros.LivetableExporterMacro</name>
    <number>0</number>
    <className>XWiki.WikiMacroClass</className>
    <guid>73140d2a-791c-4cd8-98fb-918a419346c8</guid>
    <class>
      <name>XWiki.WikiMacroClass</name>
      <customClass/>
      <customMapping/>
      <defaultViewSheet/>
      <defaultEditSheet/>
      <defaultWeb/>
      <nameField/>
      <validationScript/>
      <code>
        <disabled>0</disabled>
        <editor>Text</editor>
        <name>code</name>
        <number>9</number>
        <prettyName>Macro code</prettyName>
        <rows>20</rows>
        <size>40</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
      </code>
      <contentDescription>
        <contenttype>PureText</contenttype>
        <disabled>0</disabled>
        <editor>PureText</editor>
        <name>contentDescription</name>
        <number>8</number>
        <prettyName>Content description (Not applicable for "No content" type)</prettyName>
        <rows>5</rows>
        <size>40</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
      </contentDescription>
      <contentType>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>select</displayType>
        <multiSelect>0</multiSelect>
        <name>contentType</name>
        <number>7</number>
        <prettyName>Macro content type</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator>|</separator>
        <separators>|</separators>
        <size>1</size>
        <unmodifiable>0</unmodifiable>
        <values>Optional|Mandatory|No content</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </contentType>
      <defaultCategory>
        <disabled>0</disabled>
        <name>defaultCategory</name>
        <number>4</number>
        <prettyName>Default category</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </defaultCategory>
      <description>
        <contenttype>PureText</contenttype>
        <disabled>0</disabled>
        <editor>PureText</editor>
        <name>description</name>
        <number>3</number>
        <prettyName>Macro description</prettyName>
        <rows>5</rows>
        <size>40</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
      </description>
      <id>
        <disabled>0</disabled>
        <name>id</name>
        <number>1</number>
        <prettyName>Macro id</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </id>
      <name>
        <disabled>0</disabled>
        <name>name</name>
        <number>2</number>
        <prettyName>Macro name</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </name>
      <supportsInlineMode>
        <disabled>0</disabled>
        <displayFormType>select</displayFormType>
        <displayType>yesno</displayType>
        <name>supportsInlineMode</name>
        <number>5</number>
        <prettyName>Supports inline mode</prettyName>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
      </supportsInlineMode>
      <visibility>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>select</displayType>
        <multiSelect>0</multiSelect>
        <name>visibility</name>
        <number>6</number>
        <prettyName>Macro visibility</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator>|</separator>
        <separators>|</separators>
        <size>1</size>
        <unmodifiable>0</unmodifiable>
        <values>Current User|Current Wiki|Global</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </visibility>
    </class>
    <property>
      <code>{{velocity}}
#if($xcontext.getAction()=='view' || $xcontext.getAction()=='preview')
#set($discard = $xwiki.jsx.use("Macros.LivetableExporterMacro"))
#set($discard = $xwiki.ssx.use("Macros.LivetableExporterMacro"))
#set($discard = $services.localization.use('document', 'Macros.LivetableExporterMacroLabels')) 
#if ("$!xcontext.macro.params.async" == 'true')
 #set ($discard = $xwiki.ssfx.use('uicomponents/job/job.css', true))
 #set ($discard = $xwiki.ssfx.use('uicomponents/logging/logging.css', true))
#end
{{html clean="false"}}

&lt;script language="javascript"&gt;

#set ($format = "$!xcontext.macro.params.format")
#set ($functionName = "addButton$format")
/**
* Function adding a file export button to a livetable.
*/
function $functionName(){
  var livetableName = "livetable_$escapetool.javascript($xcontext.macro.params.livetable)";
  var livetable = window[livetableName];
  // livetable.exportToFile = XWiki.widgets.LiveTable.exportToFile;
  // add the button after the livetable
  var livetableElt = $('$escapetool.javascript($xcontext.macro.params.livetable)');
  if (!livetableElt) {
    return;
  }
  // add a button with the text and the icon
  #set ($btnLabel = "$!xcontext.macro.params.label")
  #if ($btnLabel == '')
    #set ($prettyFormat = $services.localization.render("xwiki.macro.livetableExporter.format.$format"))
    #set ($btnLabel = $services.localization.render('xwiki.macro.livetableExporter.title', $prettyFormat))
    #set ($btnIconTitle = $services.localization.render('xwiki.macro.livetableExporter.iconTitle', $prettyFormat))
  #else
    #set ($btnIconTitle = $btnLabel)
  #end
  ## prepare the limit message, if any.
  ## check if a message needs to be displayed using the following rule: if the parameter is set, priority to the parameter, true or false. If the param is not set but a limit is set, it defaults to true
  #set($hasLimitMessage = false)
  #if ("$!xcontext.macro.params.displayLimitMessage" != '')
    ## a value is set, set the value
    #set($hasLimitMessage = true)
    #if ("$!xcontext.macro.params.displayLimitMessage" == 'true')
      #set($hasLimitMessage = true)
    #else
      #set($hasLimitMessage = false)
    #end
  #else
    #if ("$!xcontext.macro.params.limit" != '' &amp;&amp; "$!numbertool.toNumber($xcontext.macro.params.limit)" != '' &amp;&amp; "$!numbertool.toNumber($xcontext.macro.params.limit)" != '0')
      #set($hasLimitMessage = true)
    #end
  #end
  #set($hasASync = false)
  #if ("$!xcontext.macro.params.async" == 'true')
   #set($hasASync = true)
  #end
  var exportButtonTitle = new Element('span', {'class': 'xwiki-livetable-tools-text'}).update('$btnLabel');
  var exportButton = new Element('button', {'class' : 'button', 'title':"$escapetool.javascript($btnIconTitle)"});
  exportButton.appendChild(exportButtonTitle);
  #if ($format == 'excel')
    var excelButtonIcon = new Element('span', {'class': 'xwiki-livetable-tools-exporter-excel'});
    exportButton.appendChild(excelButtonIcon);
  #end
  #if ($hasLimitMessage)
    #set ($limitMessageLabel = $services.localization.render('xwiki.macro.livetableExporter.limit.message', $xcontext.macro.params.limit))
    var limitMessageSpan = new Element('span', {'class':'small'});
    limitMessageSpan.update("$escapetool.javascript($limitMessageLabel)");
    exportButton.appendChild(new Element("br"));
    exportButton.appendChild(limitMessageSpan);
  #end
  exportButton.observe('click', function() { 
    console.log("in my button");
    livetable.exportToFile = XWiki.widgets.LiveTable.exportToFile;
    livetable.exportToFile($xcontext.macro.params.withPageName, $xcontext.macro.params.withPageURL, $xcontext.macro.params.withAllFields, "$escapetool.javascript("$!xcontext.macro.params.filename")", "$escapetool.javascript($format)", "$escapetool.javascript("$!xcontext.macro.params.customResults")", "$xcontext.macro.params.limit", "$escapetool.javascript("$!xcontext.macro.params.async")", "$escapetool.javascript("$!xcontext.macro.params.customDownload")"); });
  var exportSpan = new Element('span', {'class':'buttonwrapper xwiki-livetable-tools-exporter'});
  exportSpan.appendChild(exportButton);

  // Add the export div after table
  var exportDiv = $("xwiki-livetable-tools-exporter-div");
  if ($("xwiki-livetable-tools-exporter-div")==undefined) {
     exportDiv = new Element('div', {'id':'xwiki-livetable-tools-exporter-div'});
     livetableElt.insert({'after' : exportDiv});
     livetableElt.insert({'after' :  ' '});
  }

  // Add the export span inside div
  exportDiv.append(exportSpan);
  exportDiv.append(' ');

  #if($hasASync)
  if ($("xwiki-livetable-tools-exporter-status")==undefined) {
    var statusDiv = new Element('div', {'id':'xwiki-livetable-tools-exporter-status'});
    exportDiv.insert({'after' : statusDiv});
  }
  #end
}

document.observe("xwiki:dom:loaded", $functionName);

&lt;/script&gt;

{{/html}}
#else
**Macro: LivetableExporterMacro**. Adds a button that enable file export of a livetable. Works only in 'view' or 'preview' modes.
#end
{{/velocity}}</code>
    </property>
    <property>
      <contentDescription/>
    </property>
    <property>
      <contentType>No content</contentType>
    </property>
    <property>
      <defaultCategory/>
    </property>
    <property>
      <description>Add a button that can export the current livetable to a CSV or Excel file.</description>
    </property>
    <property>
      <id>livetableExporter</id>
    </property>
    <property>
      <name>Add exporter button to a livetable</name>
    </property>
    <property>
      <supportsInlineMode>1</supportsInlineMode>
    </property>
    <property>
      <visibility>Current Wiki</visibility>
    </property>
  </object>
  <object>
    <name>Macros.LivetableExporterMacro</name>
    <number>0</number>
    <className>XWiki.WikiMacroParameterClass</className>
    <guid>2d1d4d25-bd5e-49a3-9431-2859e61107d5</guid>
    <class>
      <name>XWiki.WikiMacroParameterClass</name>
      <customClass/>
      <customMapping/>
      <defaultViewSheet/>
      <defaultEditSheet/>
      <defaultWeb/>
      <nameField/>
      <validationScript/>
      <defaultValue>
        <disabled>0</disabled>
        <name>defaultValue</name>
        <number>4</number>
        <prettyName>Parameter default value</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </defaultValue>
      <description>
        <disabled>0</disabled>
        <name>description</name>
        <number>2</number>
        <prettyName>Parameter description</prettyName>
        <rows>5</rows>
        <size>40</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
      </description>
      <mandatory>
        <disabled>0</disabled>
        <displayFormType>select</displayFormType>
        <displayType>yesno</displayType>
        <name>mandatory</name>
        <number>3</number>
        <prettyName>Parameter mandatory</prettyName>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
      </mandatory>
      <name>
        <disabled>0</disabled>
        <name>name</name>
        <number>1</number>
        <prettyName>Parameter name</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </name>
    </class>
    <property>
      <defaultValue/>
    </property>
    <property>
      <description>The livetable where you want to add the file export.</description>
    </property>
    <property>
      <mandatory>1</mandatory>
    </property>
    <property>
      <name>livetable</name>
    </property>
  </object>
  <object>
    <name>Macros.LivetableExporterMacro</name>
    <number>1</number>
    <className>XWiki.WikiMacroParameterClass</className>
    <guid>45639784-7b1a-4ca0-9be3-b0696af61677</guid>
    <class>
      <name>XWiki.WikiMacroParameterClass</name>
      <customClass/>
      <customMapping/>
      <defaultViewSheet/>
      <defaultEditSheet/>
      <defaultWeb/>
      <nameField/>
      <validationScript/>
      <defaultValue>
        <disabled>0</disabled>
        <name>defaultValue</name>
        <number>4</number>
        <prettyName>Parameter default value</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </defaultValue>
      <description>
        <disabled>0</disabled>
        <name>description</name>
        <number>2</number>
        <prettyName>Parameter description</prettyName>
        <rows>5</rows>
        <size>40</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
      </description>
      <mandatory>
        <disabled>0</disabled>
        <displayFormType>select</displayFormType>
        <displayType>yesno</displayType>
        <name>mandatory</name>
        <number>3</number>
        <prettyName>Parameter mandatory</prettyName>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
      </mandatory>
      <name>
        <disabled>0</disabled>
        <name>name</name>
        <number>1</number>
        <prettyName>Parameter name</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </name>
    </class>
    <property>
      <defaultValue>true</defaultValue>
    </property>
    <property>
      <description>Set to "true" for adding a column containing the wiki page name.</description>
    </property>
    <property>
      <mandatory>0</mandatory>
    </property>
    <property>
      <name>withPageName</name>
    </property>
  </object>
  <object>
    <name>Macros.LivetableExporterMacro</name>
    <number>2</number>
    <className>XWiki.WikiMacroParameterClass</className>
    <guid>f9f25d43-140c-47db-b88c-c9f49b751974</guid>
    <class>
      <name>XWiki.WikiMacroParameterClass</name>
      <customClass/>
      <customMapping/>
      <defaultViewSheet/>
      <defaultEditSheet/>
      <defaultWeb/>
      <nameField/>
      <validationScript/>
      <defaultValue>
        <disabled>0</disabled>
        <name>defaultValue</name>
        <number>4</number>
        <prettyName>Parameter default value</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </defaultValue>
      <description>
        <disabled>0</disabled>
        <name>description</name>
        <number>2</number>
        <prettyName>Parameter description</prettyName>
        <rows>5</rows>
        <size>40</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
      </description>
      <mandatory>
        <disabled>0</disabled>
        <displayFormType>select</displayFormType>
        <displayType>yesno</displayType>
        <name>mandatory</name>
        <number>3</number>
        <prettyName>Parameter mandatory</prettyName>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
      </mandatory>
      <name>
        <disabled>0</disabled>
        <name>name</name>
        <number>1</number>
        <prettyName>Parameter name</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </name>
    </class>
    <property>
      <defaultValue>true</defaultValue>
    </property>
    <property>
      <description>Set to "true" for adding a column containing the wiki page URL.</description>
    </property>
    <property>
      <mandatory>0</mandatory>
    </property>
    <property>
      <name>withPageURL</name>
    </property>
  </object>
  <object>
    <name>Macros.LivetableExporterMacro</name>
    <number>3</number>
    <className>XWiki.WikiMacroParameterClass</className>
    <guid>b98310c7-5dda-41fc-bcb3-427b08b74cca</guid>
    <class>
      <name>XWiki.WikiMacroParameterClass</name>
      <customClass/>
      <customMapping/>
      <defaultViewSheet/>
      <defaultEditSheet/>
      <defaultWeb/>
      <nameField/>
      <validationScript/>
      <defaultValue>
        <disabled>0</disabled>
        <name>defaultValue</name>
        <number>4</number>
        <prettyName>Parameter default value</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </defaultValue>
      <description>
        <disabled>0</disabled>
        <name>description</name>
        <number>2</number>
        <prettyName>Parameter description</prettyName>
        <rows>5</rows>
        <size>40</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
      </description>
      <mandatory>
        <disabled>0</disabled>
        <displayFormType>select</displayFormType>
        <displayType>yesno</displayType>
        <name>mandatory</name>
        <number>3</number>
        <prettyName>Parameter mandatory</prettyName>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
      </mandatory>
      <name>
        <disabled>0</disabled>
        <name>name</name>
        <number>1</number>
        <prettyName>Parameter name</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </name>
    </class>
    <property>
      <defaultValue>false</defaultValue>
    </property>
    <property>
      <description>Set to "true" for forcing the export of all the fields of the class of the livetable (if any class is selected), instead of just the ones displayed as columns in the displayed livetable.</description>
    </property>
    <property>
      <mandatory>0</mandatory>
    </property>
    <property>
      <name>withAllFields</name>
    </property>
  </object>
  <object>
    <name>Macros.LivetableExporterMacro</name>
    <number>4</number>
    <className>XWiki.WikiMacroParameterClass</className>
    <guid>391f9559-350f-4545-a426-83fcca3d1bca</guid>
    <class>
      <name>XWiki.WikiMacroParameterClass</name>
      <customClass/>
      <customMapping/>
      <defaultViewSheet/>
      <defaultEditSheet/>
      <defaultWeb/>
      <nameField/>
      <validationScript/>
      <defaultValue>
        <disabled>0</disabled>
        <name>defaultValue</name>
        <number>4</number>
        <prettyName>Parameter default value</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </defaultValue>
      <description>
        <disabled>0</disabled>
        <name>description</name>
        <number>2</number>
        <prettyName>Parameter description</prettyName>
        <rows>5</rows>
        <size>40</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
      </description>
      <mandatory>
        <disabled>0</disabled>
        <displayFormType>select</displayFormType>
        <displayType>yesno</displayType>
        <name>mandatory</name>
        <number>3</number>
        <prettyName>Parameter mandatory</prettyName>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
      </mandatory>
      <name>
        <disabled>0</disabled>
        <name>name</name>
        <number>1</number>
        <prettyName>Parameter name</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </name>
    </class>
    <property>
      <defaultValue/>
    </property>
    <property>
      <description>The output filename (without extension), to which the results will be exported.</description>
    </property>
    <property>
      <mandatory>0</mandatory>
    </property>
    <property>
      <name>filename</name>
    </property>
  </object>
  <object>
    <name>Macros.LivetableExporterMacro</name>
    <number>5</number>
    <className>XWiki.WikiMacroParameterClass</className>
    <guid>12ac67e0-d4a0-4ce0-9756-b05c67125581</guid>
    <class>
      <name>XWiki.WikiMacroParameterClass</name>
      <customClass/>
      <customMapping/>
      <defaultViewSheet/>
      <defaultEditSheet/>
      <defaultWeb/>
      <nameField/>
      <validationScript/>
      <defaultValue>
        <disabled>0</disabled>
        <name>defaultValue</name>
        <number>4</number>
        <prettyName>Parameter default value</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </defaultValue>
      <description>
        <disabled>0</disabled>
        <name>description</name>
        <number>2</number>
        <prettyName>Parameter description</prettyName>
        <rows>5</rows>
        <size>40</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
      </description>
      <mandatory>
        <disabled>0</disabled>
        <displayFormType>select</displayFormType>
        <displayType>yesno</displayType>
        <name>mandatory</name>
        <number>3</number>
        <prettyName>Parameter mandatory</prettyName>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
      </mandatory>
      <name>
        <disabled>0</disabled>
        <name>name</name>
        <number>1</number>
        <prettyName>Parameter name</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </name>
    </class>
    <property>
      <defaultValue>Macros.LivetableExporterResults</defaultValue>
    </property>
    <property>
      <description>Name of a custom page generating the results, if different than the default.</description>
    </property>
    <property>
      <mandatory>0</mandatory>
    </property>
    <property>
      <name>customResults</name>
    </property>
  </object>
  <object>
    <name>Macros.LivetableExporterMacro</name>
    <number>6</number>
    <className>XWiki.WikiMacroParameterClass</className>
    <guid>3c144b4e-b9f2-4089-8d95-1d9f1de1d726</guid>
    <class>
      <name>XWiki.WikiMacroParameterClass</name>
      <customClass/>
      <customMapping/>
      <defaultViewSheet/>
      <defaultEditSheet/>
      <defaultWeb/>
      <nameField/>
      <validationScript/>
      <defaultValue>
        <disabled>0</disabled>
        <name>defaultValue</name>
        <number>4</number>
        <prettyName>Parameter default value</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </defaultValue>
      <description>
        <disabled>0</disabled>
        <name>description</name>
        <number>2</number>
        <prettyName>Parameter description</prettyName>
        <rows>5</rows>
        <size>40</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
      </description>
      <mandatory>
        <disabled>0</disabled>
        <displayFormType>select</displayFormType>
        <displayType>yesno</displayType>
        <name>mandatory</name>
        <number>3</number>
        <prettyName>Parameter mandatory</prettyName>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
      </mandatory>
      <name>
        <disabled>0</disabled>
        <name>name</name>
        <number>1</number>
        <prettyName>Parameter name</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </name>
    </class>
    <property>
      <defaultValue>excel</defaultValue>
    </property>
    <property>
      <description>Export format to be used: "excel" (default), "csv" or "json".</description>
    </property>
    <property>
      <mandatory>0</mandatory>
    </property>
    <property>
      <name>format</name>
    </property>
  </object>
  <object>
    <name>Macros.LivetableExporterMacro</name>
    <number>7</number>
    <className>XWiki.WikiMacroParameterClass</className>
    <guid>e6e9d243-5f99-4e97-82e1-f81e77cd3927</guid>
    <class>
      <name>XWiki.WikiMacroParameterClass</name>
      <customClass/>
      <customMapping/>
      <defaultViewSheet/>
      <defaultEditSheet/>
      <defaultWeb/>
      <nameField/>
      <validationScript/>
      <defaultValue>
        <disabled>0</disabled>
        <name>defaultValue</name>
        <number>4</number>
        <prettyName>Parameter default value</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </defaultValue>
      <description>
        <disabled>0</disabled>
        <name>description</name>
        <number>2</number>
        <prettyName>Parameter description</prettyName>
        <rows>5</rows>
        <size>40</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
      </description>
      <mandatory>
        <disabled>0</disabled>
        <displayFormType>select</displayFormType>
        <displayType>yesno</displayType>
        <name>mandatory</name>
        <number>3</number>
        <prettyName>Parameter mandatory</prettyName>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
      </mandatory>
      <name>
        <disabled>0</disabled>
        <name>name</name>
        <number>1</number>
        <prettyName>Parameter name</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </name>
    </class>
    <property>
      <defaultValue/>
    </property>
    <property>
      <description>Label of the export button.</description>
    </property>
    <property>
      <mandatory>0</mandatory>
    </property>
    <property>
      <name>label</name>
    </property>
  </object>
  <object>
    <name>Macros.LivetableExporterMacro</name>
    <number>8</number>
    <className>XWiki.WikiMacroParameterClass</className>
    <guid>a275aba3-2ad0-4f37-ae0a-12a2be421a93</guid>
    <class>
      <name>XWiki.WikiMacroParameterClass</name>
      <customClass/>
      <customMapping/>
      <defaultViewSheet/>
      <defaultEditSheet/>
      <defaultWeb/>
      <nameField/>
      <validationScript/>
      <defaultValue>
        <disabled>0</disabled>
        <name>defaultValue</name>
        <number>4</number>
        <prettyName>Parameter default value</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </defaultValue>
      <description>
        <disabled>0</disabled>
        <name>description</name>
        <number>2</number>
        <prettyName>Parameter description</prettyName>
        <rows>5</rows>
        <size>40</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
      </description>
      <mandatory>
        <disabled>0</disabled>
        <displayFormType>select</displayFormType>
        <displayType>yesno</displayType>
        <name>mandatory</name>
        <number>3</number>
        <prettyName>Parameter mandatory</prettyName>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
      </mandatory>
      <name>
        <disabled>0</disabled>
        <name>name</name>
        <number>1</number>
        <prettyName>Parameter name</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </name>
    </class>
    <property>
      <defaultValue>0</defaultValue>
    </property>
    <property>
      <description>Sets a higer limit to the number of entries that can be exported. This parameter was introduced in particular for avoiding to load the server too much in case of very large exports, which require the macro script to load each page. Leave empty or to "0" for exporting all result entries.</description>
    </property>
    <property>
      <mandatory>0</mandatory>
    </property>
    <property>
      <name>limit</name>
    </property>
  </object>
  <object>
    <name>Macros.LivetableExporterMacro</name>
    <number>9</number>
    <className>XWiki.WikiMacroParameterClass</className>
    <guid>6878fb46-e3e8-4544-8bbc-cae6e5e6c83f</guid>
    <class>
      <name>XWiki.WikiMacroParameterClass</name>
      <customClass/>
      <customMapping/>
      <defaultViewSheet/>
      <defaultEditSheet/>
      <defaultWeb/>
      <nameField/>
      <validationScript/>
      <defaultValue>
        <disabled>0</disabled>
        <name>defaultValue</name>
        <number>4</number>
        <prettyName>Parameter default value</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </defaultValue>
      <description>
        <disabled>0</disabled>
        <name>description</name>
        <number>2</number>
        <prettyName>Parameter description</prettyName>
        <rows>5</rows>
        <size>40</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
      </description>
      <mandatory>
        <disabled>0</disabled>
        <displayFormType>select</displayFormType>
        <displayType>yesno</displayType>
        <name>mandatory</name>
        <number>3</number>
        <prettyName>Parameter mandatory</prettyName>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
      </mandatory>
      <name>
        <disabled>0</disabled>
        <name>name</name>
        <number>1</number>
        <prettyName>Parameter name</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </name>
    </class>
    <property>
      <defaultValue/>
    </property>
    <property>
      <description>Whether the message mentioning the export limit should be displayed or not. Defaults to "true" if a limit is set.</description>
    </property>
    <property>
      <mandatory>0</mandatory>
    </property>
    <property>
      <name>displayLimitMessage</name>
    </property>
  </object>
  <object>
    <name>Macros.LivetableExporterMacro</name>
    <number>10</number>
    <className>XWiki.WikiMacroParameterClass</className>
    <guid>1920d329-e279-477c-8e93-b78bd17352ea</guid>
    <class>
      <name>XWiki.WikiMacroParameterClass</name>
      <customClass/>
      <customMapping/>
      <defaultViewSheet/>
      <defaultEditSheet/>
      <defaultWeb/>
      <nameField/>
      <validationScript/>
      <defaultValue>
        <disabled>0</disabled>
        <name>defaultValue</name>
        <number>4</number>
        <prettyName>Parameter default value</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </defaultValue>
      <description>
        <disabled>0</disabled>
        <name>description</name>
        <number>2</number>
        <prettyName>Parameter description</prettyName>
        <rows>5</rows>
        <size>40</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
      </description>
      <mandatory>
        <disabled>0</disabled>
        <displayFormType>select</displayFormType>
        <displayType>yesno</displayType>
        <name>mandatory</name>
        <number>3</number>
        <prettyName>Parameter mandatory</prettyName>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
      </mandatory>
      <name>
        <disabled>0</disabled>
        <name>name</name>
        <number>1</number>
        <prettyName>Parameter name</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </name>
    </class>
    <property>
      <defaultValue>false</defaultValue>
    </property>
    <property>
      <description>Run the export in async mode if "true"</description>
    </property>
    <property>
      <mandatory>0</mandatory>
    </property>
    <property>
      <name>async</name>
    </property>
  </object>
  <object>
    <name>Macros.LivetableExporterMacro</name>
    <number>11</number>
    <className>XWiki.WikiMacroParameterClass</className>
    <guid>edabe9c0-2851-4e78-9ef9-a9544c5b33ca</guid>
    <class>
      <name>XWiki.WikiMacroParameterClass</name>
      <customClass/>
      <customMapping/>
      <defaultViewSheet/>
      <defaultEditSheet/>
      <defaultWeb/>
      <nameField/>
      <validationScript/>
      <defaultValue>
        <disabled>0</disabled>
        <name>defaultValue</name>
        <number>4</number>
        <prettyName>Parameter default value</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </defaultValue>
      <description>
        <disabled>0</disabled>
        <name>description</name>
        <number>2</number>
        <prettyName>Parameter description</prettyName>
        <rows>5</rows>
        <size>40</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
      </description>
      <mandatory>
        <disabled>0</disabled>
        <displayFormType>select</displayFormType>
        <displayType>yesno</displayType>
        <name>mandatory</name>
        <number>3</number>
        <prettyName>Parameter mandatory</prettyName>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
      </mandatory>
      <name>
        <disabled>0</disabled>
        <name>name</name>
        <number>1</number>
        <prettyName>Parameter name</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </name>
    </class>
    <property>
      <defaultValue>Macros.LivetableExporterResultsAsyncDownload</defaultValue>
    </property>
    <property>
      <description/>
    </property>
    <property>
      <mandatory>0</mandatory>
    </property>
    <property>
      <name>customDownload</name>
    </property>
  </object>
</xwikidoc>
